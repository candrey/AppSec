
# Установка и использование open-source сканера уязвимостей Trivy

## 1. Выбор и установка сканера уязвимостей

Для выполнения задания был выбран сканер Trivy, так как он поддерживает анализ уязвимостей в зависимостях, контейнерах, файловых системах и конфигурациях, а также прост в использовании и имеет открытый исходный код.

Шаги установки:

Trivy не требует установки и может быть запущен из Docker контейнера.

```bash
docker pull aquasec/trivy:0.58.2
```

## 2. Настройка сканера для анализа зависимостей

В качестве целевого проекта был выбран проект [Damn Vulnerable SCA Application](https://github.com/harekrishnarai/Damn-vulnerable-sca).

Клонируем репозиторий и переходим в каталог репозитория. Дополнительно скачаем базы данных уязвимостей.

```bash
git clone https://github.com/harekrishnarai/Damn-vulnerable-sca.git
cd ./Damn-vulnerable-sca
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v cache\trivydb:/root/.cache/ aquasec/trivy:0.58.2 image --download-java-db-only --no-progress --timeout 15m
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v cache\trivydb:/root/.cache/ aquasec/trivy:0.58.2 image --download-db-only --no-progress --timeout 15m
```

## 3. Проведение сканирования и сбор результатов

В рамках лабораторной работы проведём анализ уязвистей критического и высокого уровней.

```bash
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v cache\trivydb:/root/.cache/ -v .:/app aquasec/trivy:0.58.2 fs --severity HIGH,CRITICAL . > ../trivy.log
```

Сканирование заняло несколько минут. Результаты были выведены в файл ../trivy.logs.

## 4. Анализ результатов сканирования

Результаты сканирования:

### alpine

Найдено 2 уязвимых пакета с высоким уровнем критичности

CVE-2024-12797 (HIGH)
Уязвимость режима SSL_VERIFY_PEER криптографической библиотеки OpenSSL связана с отсутствием механизма уведомления пользователя об установлении сеанса связи. Эксплуатация уязвимости может позволить нарушителю, действующему удаленно, реализовать атаку типа «человек-посередине» в ходе соединения TLS/DTLS
Для устранения данной уязвимости необходимо обновить OpenSSL до версии 3.3.3-r0

### app/backend/pom.xml (pom)

Найдено 66 уязвимостей из них 56 высокого и 10 критческого уровня

- CVE-2020-9546 (CRITICAL), CVE-2020-9547 (CRITICAL), CVE-2020-9548 (CRITICAL) и др
Уязвимость в библиотеке com.fasterxml.jackson.core:jackson-databind
Для устранения уязимости необходимо обновить библиотеку с версии 2.9.10.3 до 2.9.10.4 версии.
- CVE-2018-1000134 (CRITICAL)
Уязвимость в библиотеке com.unboundid:unboundid-ldapsdk
Для устранения уязимости необходимо обновить библиотеку с версии 3.1.1 до 4.0.5
- CVE-2021-44228 (CRITICAL), CVE-2021-45046 (CRITICAL), CVE-2021-45105 (HIGH)
Уязвимость в библиотеке org.apache.logging.log4j:log4j-core
Для устранения уязимости необходимо обновить библиотеку с версии 2.11.2 до 2.12.3

и пр.

### app/package-lock.json (npm)

Найдено 9 уязвимостей из них 9 высокого уровня

- CVE-2024-45590 (HIGH)
Уязвимость в библиотеке body-parser
Для устранения уязимости необходимо обновить библиотеку с версий 1.20.1 и 1.20.2 до 1.20.3
- CVE-2024-29415 (HIGH)
Уязвимость в библиотеке node-ip
Для устранения уязимости необходимо обновить библиотеку с версии 1.1.8 до 1.1.9
- CVE-2017-16114 (HIGH), CVE-2022-21680 (HIGH), CVE-2022-21681 (HIGH)
Уязвимость в модуле marked
Для устранения уязимости необходимо обновить модуль с версии 0.3.5 до 0.3.9
- CVE-2024-45296 (HIGH), CVE-2024-52798 (HIGH)
Уязвимость в библиотеке path-to-regexp
Для устранения уязимости необходимо обновить модуль с версии 0.1.7 до 0.1.12
- CVE-2021-33623
Уязвимость в библиотеке trim-newlines
Для устранения уязимости необходимо обновить модуль с версии 4.0.0 до 4.0.1

## 5. Заключение

Установлен и настроен сканер Trivy, проведено сканирование зависимостей, проанализированы результаты и приведены рекомендацияии по устранению уязвимостей.
