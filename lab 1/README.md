# Схема защищенной микросервисной архитектуры на виртуальных машинах с использованием CI/CD

## Архитектура микросервисов

Архитектура системы состоит из нескольких микросервисов, развертываемых на отдельных виртуальных машинах. Каждый микросервис отвечает за свою часть функциональности приложения. Взаимодействие между сервисами осуществляется через API Gateway, который также обеспечивает защиту от веб-атак с помощью WAF (Web Application Firewall).

### Микросервисы

У нас есть следующие микросервисы:

1. Auth Service: отвечает за аутентификацию пользователей.
2. Notification Service: отправляет уведомления пользователям.

Каждый микросервис имеет собственную базу данных и развернут на отдельной виртуальной машине.

#### Взаимодействие через API Gateway

Все запросы от клиентов проходят через API Gateway. Он выполняет следующие функции:

- Маршрутизацию запросов к соответствующим микросервисам.
- Аутентификацию и авторизацию.
- Ограничение скорости запросов (rate limiting).
- Логирование и мониторинг запросов.
- Обработку ошибок и их передачу клиенту.

API Gateway защищен с помощью WAF, который фильтрует входящие запросы и блокирует подозрительные активности, такие как SQL-инъекции, XSS-атаки и другие виды атак.

#### Балансировка нагрузки

Для обеспечения высокой доступности и производительности используем HAProxy в качестве балансировщика нагрузки. HAProxy будет распределять трафик между несколькими экземплярами каждого микросервиса, обеспечивая равномерную нагрузку и отказоустойчивость.

### Средства безопасности

Включаем различные инструменты безопасности в процесс разработки и CI/CD конвейера:

1. SAST (Static Application Security Testing) – статический анализ кода для выявления уязвимостей на этапе разработки.

2. DAST (Dynamic Application Security Testing) – динамический анализ приложений для поиска уязвимостей при выполнении. Используем OWASP ZAP.

3. OSA (Open Source Analysis) – анализ зависимостей на наличие известных уязвимостей.

4. SCA (Software Composition Analysis) – анализ состава программного обеспечения для обнаружения уязвимых библиотек.

5. Fuzzing – тестирование на устойчивость к неожиданным входным данным.

Эти шаги интегрированы в CI/CD конвейер GitLab, чтобы обеспечить автоматическое выполнение проверок безопасности при каждом коммите или слиянии веток.

### Мониторинг и логирование

Для мониторинга и логирования каждого микросервиса используем комбинацию инструментов:

1. Prometheus для сбора метрик.
2. Grafana для визуализации метрик и создания дашбордов.
3. ELK (Elasticsearch, Logstash, Kibana) для централизованного хранения и анализа логов.

Каждый микросервис экспортирует свои метрики в Prometheus, а логи собираются и отправляются в Elasticsearch через Logstash. Kibana используется для анализа логов и выявления аномалий.

### Схема архитектуры

На схеме ниже представлена архитектура системы с указанием виртуальных машин, средств защиты и использования GitLab CI/CD.
